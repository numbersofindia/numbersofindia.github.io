"use strict";window.onload=function(){section0()};
"use strict";function section0(){var c=125,m=47,r=[["good",0,12,0,50,"#27ae60"],["moderate",12,35.5,50,100,"#f1c40f"],["unhealthy for sensitive groups",35.5,55.5,100,150,"#e67e22"],["unhealthy",55.5,150.5,150,200,"#e84118"],["very unhealthy",150.5,250.5,200,300,"#c23616"],["hazardous",250.5,500.5,300,500,"#6F1E51"]];function g(t,n,e,i,a,r,h){this.x=t,this.y=n,this.sx=i,this.sy=a,this.r=e,this.canvas=r,this.ctx=h,this.bounce=-1,this.drawCircle=function(){this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.r,0,2*Math.PI,!1),this.ctx.fillStyle="#fff",this.ctx.fill()},this.moveCircle=function(){this.x+=this.sx,this.y+=this.sy,this.x+this.r>this.canvas.width?(this.x=this.canvas.width-this.r,this.sx*=this.bounce):this.x-this.r<0&&(this.x=this.r,this.sx*=this.bounce),this.y+this.r>this.canvas.height?(this.y=this.canvas.height-this.r,this.sy*=this.bounce):this.y-this.r<0&&(this.y=this.r,this.sy*=this.bounce)}}function y(t){for(var n=0;n<r.length&&!(t>=r[n][3]&&t<=r[n][4]);n++);var e=r[n][3],i=r[n][4],a=r[n][1];return(t-e)*(r[n][2]-a)/(i-e)+a}function a(t){for(var n=0;n<r.length&&!(t>=r[n][3]&&t<=r[n][4]);n++);return n}Promise.all([d3.csv("./res/total.csv"),d3.csv("./res/month2.csv")]).then(function(t){var n=t[0],i=t[1],f=["new-delhi","mumbai","bangalore","kolkata","chennai","hyderabad","new-york","los-angeles","san-francisco","paris","london","madrid","hong-kong","jakarta","singapore","beijing","shanghai","dhaka","saÌƒo paulo","bogota","auckland","toronto","dubai","tokyo","moscow","amsterdam","istanbul","nairobi","cape town","johannesburg"],d=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];n.sort(function(t,n){return f.indexOf(t.city)-f.indexOf(n.city)}),i.sort(function(t,n){return f.indexOf(t.city)-f.indexOf(n.city)});var s=new Array(n.length).fill(0),u=new Array(i.length).fill(0).map(function(){return new Array(12).fill(0)});f.forEach(function(t){return $("#city-search").append(' <option value="'+t+'">'+t+"</option>")}),d3.select("#squares").selectAll("g").data(n).enter().append("canvas").attr("width",c).attr("height",c).attr("class","cities").attr("id",function(t,n){return"city-"+n}).style("border",function(t,n){var e=a(t.pm25);return"3px solid "+r[e][5]}),n.forEach(function(e,i){var a=document.getElementById("city-"+i);a.width=c,a.height=c;for(var r=a.getContext("2d"),h=[],t=Math.floor(y(e.pm25)),n=0;n<t;n++){var o=new g(Math.random()*a.width,Math.random()*a.height,2,2*Math.random(),2*Math.random(),a,r);h.push(o)}s[i]=requestAnimationFrame(function t(){r.clearRect(0,0,a.width,a.height),r.font="15px Josefin Sans",r.fillStyle="#fff",r.textAlign="center",r.fillText(e.city,a.width/2,a.height/2+5);for(var n=0;n<h.length;n++)h[n].drawCircle(),h[n].moveCircle();s[i]=requestAnimationFrame(t)})}),$("#city-search").dropdown({maxSelections:3,onChange:function(t,n,e){console.log(t),u.forEach(function(t){t.forEach(function(t){return cancelAnimationFrame(t)})}),d3.selectAll(".month-divs").remove(),t.forEach(function(c){var l=i.find(function(t){return t.city==c});d3.select("#squares-month").append("div").attr("class","month-divs").selectAll("canvas").data(function(t,n){return new Array(13).fill(0)}).enter().append("canvas").attr("width",m).attr("height",m).attr("class","months").attr("id",function(t,n){return"mon-"+c+"-"+n}).style("border",function(t,n){var e=a(l[d[n-1]]);return 0<n?"2px solid "+r[e][5]:"2px solid #fff"}),new Array(12).fill(0).forEach(function(t,e){var i=document.getElementById("mon-"+c+"-"+(e+1));i.width=m,i.height=m;for(var a=i.getContext("2d"),r=[],h=d[e],n=Math.floor(y(l[h])),o=0;o<n;o++){var s=new g(Math.random()*i.width,Math.random()*i.height,1,2*Math.random(),2*Math.random(),i,a);r.push(s)}u[f.indexOf(c)][e]=requestAnimationFrame(function t(){a.clearRect(0,0,i.width,i.height),a.font="15px Josefin Sans",a.fillStyle="#fff",a.textAlign="center",a.fillText(h,i.width/2,i.height/2+5);for(var n=0;n<r.length;n++)r[n].drawCircle(),r[n].moveCircle();u[f.indexOf(c)][e]=requestAnimationFrame(t)})});var t=document.getElementById("mon-"+c+"-0");t.width=m,t.height=m;var n=t.getContext("2d");n.font="10px Josefin Sans",n.fillStyle="#fff",n.textAlign="center",n.fillText(c,t.width/2,t.height/2+5)})}}),$("#city-search").dropdown("set selected",["new-delhi","new-york"])})}