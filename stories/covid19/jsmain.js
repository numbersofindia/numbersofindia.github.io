"use strict";window.onload=function(){section2()};
"use strict";function section1(l){var c={Orissa:"Odisha","Jammu & Kashmir":"Jammu and Kashmir",Ladakh:"Ladakh"};function r(n,e,a){var i=document.getElementById("tooltip"),r=$("#deck-map").offset();if("none"!==n){var t=[0,0,0];if(d.includes(n)){var s=l.data.regional.filter(function(e){return e.loc===n})[0];t=[s.confirmedCasesIndian+s.confirmedCasesForeign,s.discharged,s.deaths]}else if(n in c){var o=c[n];t=[(o=l.data.regional.filter(function(e){return e.loc===o})[0]).confirmedCasesIndian+o.confirmedCasesForeign,o.discharged,o.deaths]}i.innerHTML='<p><span style="font-weight:800; letter-spacing: 3px; text-transform: uppercase">'+n+'</span><br><span style="color:#2980b9">Cases</span> : '+t[0]+'<br><span style="color:#27ae60">Recovered</span> : '+t[1]+'<br><span style="color:#c0392b">Deaths</span> : '+t[2]+"<br></p>",i.style.display="block",i.style.left=e+r.left+"px",i.style.top=a+r.top+"px"}else i.style.display="none"}var t=d3.scaleLinear().domain(d3.extent(l.data.regional,function(e){return e.confirmedCasesIndian+e.confirmedCasesForeign})).range([0,1]),d=l.data.regional.map(function(e){return e.loc});console.log("STATES : ",d);var e=+d3.select("#deck-map").style("width").slice(0,-2),n=+d3.select("#deck-map").style("height").slice(0,-2);new Deck({canvas:"deck-canvas",width:e,height:n,initialViewState:{latitude:23,longitude:80,zoom:2.9,bearing:2,pitch:0},controller:{scrollZoom:!1},touchAction:"pan-y",layers:[new GeoJsonLayer({data:"../../res/india_pc_2020.geojson",stroked:!0,filled:!0,wireframe:!0,getLineColor:[0,0,0,150],pickable:!0,getLineWidth:100,lineWidthMinPixels:.3,getFillColor:function(n){var e=0;if(d.includes(n.properties.st_name))e=(e=l.data.regional.filter(function(e){return e.loc===n.properties.st_name})[0]).confirmedCasesIndian+e.confirmedCasesForeign;else if(n.properties.st_name in c){var a=c[n.properties.st_name];e=(e=l.data.regional.filter(function(e){return e.loc===a})[0]).confirmedCasesIndian+e.confirmedCasesForeign}var i=d3.color(d3.interpolateReds(t(e))).rgb();return[i.r,i.g,i.b]},onHover:function(e){var n=e.object,a=e.x,i=e.y;r(n?n.properties.st_name:"none",a,i)},material:{ambient:.5,diffuse:.9,shininess:255,specularColor:[0,0,0]}})]})}
"use strict";function section2(){function m(e,t,a,n,r,d,i){n=Math.min(+d3.select(a).style("width").slice(0,-2),n),r=Math.min(+d3.select(a).style("height").slice(0,-2),r);var o=d3.scaleLinear().domain([0,e.length-1]).range([d,n-d]),s=d3.scaleLinear().domain(d3.extent(e,function(e){return e[t]})).range([r,d]),c=d3.area().curve(d3.curveLinear).x(function(e,t){return o(t)}).y0(s(0)).y1(function(e){return s(e[t])}),l=d3.line().x(function(e,t){return o(t)}).y(function(e){return s(e[t])}),h=d3.select(a).append("svg").attr("width",n).attr("height",r);h.append("path").datum(e).attr("fill",i).attr("opacity",.3).attr("d",c),h.append("path").datum(e).attr("stroke",i).attr("stroke-width","2px").attr("fill","none").attr("d",l)}Promise.all([d3.json("https://api.rootnet.in/covid19-in/stats/latest"),d3.json("https://api.rootnet.in/covid19-in/stats/daily"),d3.json("https://pomber.github.io/covid19/timeseries.json")]).then(function(e){var t=e[0],a=e[1],n=e[2],r={};!function(e,t,a){var n=new Date(e.lastOriginUpdate);$("#updated-date").html(n.toLocaleString());for(var r=[0,0,0],d=[0,0,0],i=[],o=[],s=0;s<a.India.length;s++)o.push([0,0,0]),i.push([0,0,0]);for(var c=0,l=Object.keys(a);c<l.length;c++){var h=l[c],p=a[h];r[0]+=parseInt(p[p.length-1].confirmed),r[1]+=parseInt(p[p.length-1].recovered),r[2]+=parseInt(p[p.length-1].deaths),p.map(function(e,t){o[t][0]+=parseInt(e.confirmed),o[t][1]+=parseInt(e.recovered),o[t][2]+=parseInt(e.deaths),"India"===h&&(i[t][0]+=parseInt(e.confirmed),i[t][1]+=parseInt(e.recovered),i[t][2]+=parseInt(e.deaths))})}d[0]+=e.data.summary.total,d[1]+=e.data.summary.discharged,d[2]+=e.data.summary.deaths,$("#world-cases").html(r[0].toLocaleString()),$("#world-recovered").html(r[1].toLocaleString()),$("#world-dead").html(r[2].toLocaleString()),$("#india-cases").html(d[0].toLocaleString()),$("#india-recovered").html(d[1].toLocaleString()),$("#india-dead").html(d[2].toLocaleString()),$("#spinner-1").hide(),$("#spinner-1-replacement").css("display","flex"),$("#world-recovered-perc").html((100*r[1]/r[0]).toFixed(1)+"%"),$("#world-dead-perc").html((100*r[2]/r[0]).toFixed(1)+"%"),$("#india-recovered-perc").html((100*d[1]/d[0]).toFixed(1)+"%"),$("#india-dead-perc").html((100*d[2]/d[0]).toFixed(1)+"%"),m(i,0,"#india-cases-plot",200,100,10,"#2980b9"),m(i,1,"#india-recovered-plot",200,100,10,"#27ae60"),m(i,2,"#india-dead-plot",200,100,10,"#c0392b"),m(o,0,"#world-cases-plot",200,100,10,"#27ae60"),m(o,1,"#world-recovered-plot",200,100,10,"#2980b9"),m(o,2,"#world-dead-plot",200,100,10,"#c0392b")}(t,0,n),section1(t),$.when(formatIndiaDaily(a,r)).then(section3(n,r))})}function formatIndiaDaily(e,d){e.data.map(function(e){var r=e.day;e.regional.map(function(e){var t=e.confirmedCasesIndian+e.confirmedCasesForeign,a=e.discharged,n=e.deaths;d[e.loc]?d[e.loc].push({date:r,confirmed:t,recovered:a,deaths:n}):d[e.loc]=[{date:r,confirmed:t,recovered:a,deaths:n}]})})}
"use strict";function initlinePlot(t,e){var a=+d3.select(t).style("width").slice(0,-2),l=Math.max(+d3.select(t).style("height").slice(0,-2),500);d3.select(t).append("svg").attr("width",a).attr("height",l).attr("id",e)}function drawLinePlots(t,e,a,l,i){var n={world:["#c0392b","#2980b9","#2c3e50","#27ae60","#f1c40f"],india:["#84817a","#ff793f","#b33939","#227093","#2c2c54"]},r=t.split("-");r=r[r.length-1],n=n[r],console.log(a);var o=+d3.select(t).style("width").slice(0,-2),s=Math.max(+d3.select(t).style("height").slice(0,-2),500),c=d3.select(e),d=50,p=d3.timeParse("%Y-%m-%d"),v=d3.timeFormat("%b %d"),u=d3.scaleTime().domain(d3.extent(a[Object.keys(a)[0]],function(t){return p(t.date)})).range([50,o-50]),g=[];for(var m in a)console.log(m),a[m].map(function(t){return g.push(t[l])});var f,w=d3.scaleLinear().domain(d3.extent(g)).range([s-d,d]),h=d3.scaleLog().domain([1,1e5]).range([s-d,d]);"linear"===i?f=w:"log"===i&&(f=h);var x=d3.line().x(function(t){return u(p(t.date))}).y(function(t){return"linear"===i?f(t[l]):"log"===i?f(t[l]+1):void 0}).curve(d3.curveMonotoneX);d3.selectAll("#x-axis-"+r).remove(),d3.selectAll("#y-axis-"+r).remove();var y=10;o<600&&(y=5),c.append("g").attr("class","x axis").attr("id","x-axis-"+r).attr("transform","translate(0,"+(s-d)+")").call(d3.axisBottom(u).tickFormat(v).tickSize(100-s).ticks(y)),"linear"==i?c.append("g").attr("class","y axis").attr("id","y-axis-"+r).attr("transform","translate(50,0)").call(d3.axisLeft(f).tickSize(50-o+50).tickFormat(function(t){return"world"==r?t/1e3+"k":"india"==r?t:void 0}).ticks(8)):"log"==i&&c.append("g").attr("class","y axis").attr("id","y-axis-"+r).attr("transform","translate(50,0)").call(d3.axisLeft(f).tickSize(50-o+50).tickFormat(function(t){return t/1e3+"k"}).ticks(5));var $;c.transition().duration(750);d3.selectAll(".line-"+r).remove(),d3.selectAll(".circles-"+r).remove(),d3.selectAll(".text-legend-"+r).remove(),d3.selectAll(".text-title-plot-"+r).remove(),"confirmed"===l?$="Cases":"recovered"===l?$="Recovered":"deaths"===l&&($="Deaths"),c.append("text").attr("class","text-title-plot-"+r).attr("id","text-title").attr("fill","#000").attr("x",o/2).attr("y",f.range()[0]+40).attr("text-anchor","middle").text("Cumulative "+$+" vs Time");function k(){var e=n[P];c.append("text").attr("class","text-legend-"+r).attr("id","text-"+m.replace(" ,-")).attr("fill",e).attr("x",u.range()[0]+50).attr("y",30*P+100).attr("text-anchor","middle").text(m),c.append("path").datum(a[m]).attr("class","line line-"+r).attr("id","line-"+m.replace(" ,-")).attr("d",x).attr("fill","none").attr("stroke",e).attr("stroke-width",2),c.append("g").selectAll(".circle-"+m.replace(" ,-")).data(a[m]).join(function(t){return t.append("circle").attr("class","circles circle-"+m.replace(" ,-")+" circles-"+r).attr("cx",function(t){return u(p(t.date))}).attr("cy",function(t){return"linear"===i?f(t[l]):"log"===i?f(t[l]+1):void 0}).attr("r",3.5).attr("fill",e).on("mouseover",function(t){var e=this;L.transition().duration(200).style("display","block"),L.html(function(){return'<span style="font-weight:800; letter-spacing: 2px; color:#c0392b; text-transform: uppercase">'+d3.select(e).attr("class").replace("circles ","").replace("circle-","").replace("circles-india","").replace("circles-world","")+"</span><br>"+v(p(t.date))+"<br>"+t[l].toLocaleString()}).style("left",d3.event.pageX-100+"px").style("top",d3.event.pageY-60+"px")}).on("mouseout",function(t){L.transition().duration(500).style("display","none")})}),P+=1}var L=d3.select("#tooltip2"),P=0;for(var m in a)k()}function section3(l,i){var n,r,o="confirmed",s="linear";for(var t in l)$("#country-search").append(' <option value="'+t+'">'+t+"</option>");for(var t in i)$("#state-search").append(' <option value="'+t+'">'+t+"</option>");var c=!1,d=!1;$("#country-search").dropdown({maxSelections:5,onChange:function(t,e,a){n={},t.map(function(t){n[t]=l[t]}),c?drawLinePlots("#line-plots-world","#svg-plot-world",n,o,s):($.when(initlinePlot("#line-plots-world","svg-plot-world")).then(drawLinePlots("#line-plots-world","#svg-plot-world",n,o,s)),c=!0)}}),$("#state-search").dropdown({maxSelections:5,onChange:function(t,e,a){r={},t.map(function(t){r[t]=i[t]}),d?drawLinePlots("#line-plots-india","#svg-plot-india",r,o,s):($.when(initlinePlot("#line-plots-india","svg-plot-india")).then(drawLinePlots("#line-plots-india","#svg-plot-india",r,o,s)),d=!0)}}),$("#country-search").dropdown("set selected",["India","Italy","US"]),$("#state-search").dropdown("set selected",["Karnataka","Kerala","Maharashtra"]),$("#linear").click(function(){$(".y-axis-scales").removeClass("active"),$("#linear").addClass("active"),drawLinePlots("#line-plots-world","#svg-plot-world",n,o,s="linear"),drawLinePlots("#line-plots-india","#svg-plot-india",r,o,s)}),$("#log").click(function(){$(".y-axis-scales").removeClass("active"),$("#log").addClass("active"),drawLinePlots("#line-plots-world","#svg-plot-world",n,o,s="log"),drawLinePlots("#line-plots-india","#svg-plot-india",r,o,s)}),$("#cat-cases").click(function(){$(".category-button").removeClass("active"),$("#cat-cases").addClass("active"),o="confirmed",$("#cumu-title").html("Confirmed Cases"),drawLinePlots("#line-plots-world","#svg-plot-world",n,o,s),drawLinePlots("#line-plots-india","#svg-plot-india",r,o,s)}),$("#cat-recovered").click(function(){$(".category-button").removeClass("active"),$("#cat-recovered").addClass("active"),o="recovered",$("#cumu-title").html("Recovered"),drawLinePlots("#line-plots-world","#svg-plot-world",n,o,s),drawLinePlots("#line-plots-india","#svg-plot-india",r,o,s)}),$("#cat-deaths").click(function(){$(".category-button").removeClass("active"),$("#cat-deaths").addClass("active"),o="deaths",$("#cumu-title").html("Deaths"),drawLinePlots("#line-plots-world","#svg-plot-world",n,o,s),drawLinePlots("#line-plots-india","#svg-plot-india",r,o,s)})}